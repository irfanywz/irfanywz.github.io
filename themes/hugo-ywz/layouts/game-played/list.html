{{ define "main" }}
    <main class="flex-grow bg-white dark:bg-gray-900 transition-colors duration-300"
        x-data="{
            genre: 'all',
            filterOpen: false,
            items: [
                {{ range .Pages }}
                {
                    title: {{ .Title | jsonify }},
                    genre: {{ .Params.genre | default "" | jsonify }},
                    permalink: {{ .RelPermalink | jsonify }},
                    cover: {{ .Params.cover | jsonify }},
                    rating: {{ .Params.rating | jsonify }},
                    platform: {{ .Params.platform | jsonify }}
                },
                {{ end }}
            ],
            get filteredItems() {
                if (this.genre === 'all') return this.items;
                return this.items.filter(i => i.genre === this.genre);
            }
        }">

        <div class="container max-w-6xl mx-auto px-4 py-12">
            <!-- Header 2 Kolom -->
            <div class="flex flex-col md:flex-row md:items-end justify-between gap-6 mb-12 border-b border-gray-100 dark:border-gray-800 pb-8">
                <div class="max-w-2xl">
                    <h1 class="text-4xl font-black text-gray-900 dark:text-white mb-2 tracking-tight flex items-center gap-3">
                        <span class="icon-[ri--gamepad-line] text-emerald-500"></span>
                        {{ .Title }}
                    </h1>
                    <p class="text-lg text-gray-500 dark:text-gray-400">{{ .Description }}</p>
                </div>
                
                <button @click="filterOpen = true" class="flex items-center gap-2 px-5 py-2.5 bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-900 dark:text-white rounded-xl font-bold transition-all">
                    <span class="icon-[ri--filter-3-line]"></span>
                    <span x-text="genre === 'all' ? 'Semua Genre' : genre"></span>
                    <span class="icon-[ri--arrow-down-s-line] opacity-50"></span>
                </button>
            </div>

            <!-- Grid Game -->
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                <template x-for="item in filteredItems" :key="item.permalink">
                    <a :href="item.permalink" class="group relative block bg-gray-900 rounded-2xl overflow-hidden shadow-md hover:shadow-xl transition-all duration-300 hover:-translate-y-1 border border-gray-200 dark:border-gray-700">
                        <div class="relative aspect-video overflow-hidden">
                            <img :src="item.cover" :alt="item.title" class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105 opacity-90 group-hover:opacity-100">
                            <div class="absolute inset-0 bg-gradient-to-t from-gray-900 via-transparent to-transparent opacity-90"></div>
                            
                            <div class="absolute top-3 right-3">
                                <span class="px-2 py-1 bg-black/60 backdrop-blur-md text-white text-xs font-bold rounded-lg border border-white/10 flex items-center gap-1">
                                    <i class="icon-[ri--star-fill] text-yellow-400"></i> <span x-text="item.rating"></span>
                                </span>
                            </div>

                            <div class="absolute bottom-0 left-0 right-0 p-5">
                                <h2 class="text-xl font-bold text-white leading-tight mb-2 drop-shadow-md group-hover:text-emerald-400 transition-colors" x-text="item.title"></h2>
                                <div class="flex flex-wrap gap-2">
                                    <template x-if="Array.isArray(item.platform)">
                                        <template x-for="p in item.platform">
                                            <span class="text-[10px] font-bold uppercase tracking-wider bg-white/20 text-white px-2 py-0.5 rounded backdrop-blur-sm" x-text="p"></span>
                                        </template>
                                    </template>
                                    <template x-if="!Array.isArray(item.platform)">
                                        <span class="text-[10px] font-bold uppercase tracking-wider bg-white/20 text-white px-2 py-0.5 rounded backdrop-blur-sm" x-text="item.platform"></span>
                                    </template>
                                </div>
                            </div>
                        </div>
                    </a>
                </template>
            </div>
            
            <div x-show="filteredItems.length === 0" class="text-center py-20" style="display: none;">
                <p class="text-gray-500">Tidak ada game dengan genre ini.</p>
            </div>
        </div>

        <!-- Filter Modal -->
        <div x-show="filterOpen" 
            style="display: none;"
            class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm"
            x-transition.opacity
            @click.self="filterOpen = false">
            
            <div class="bg-white dark:bg-gray-900 rounded-2xl shadow-2xl w-full max-w-md overflow-hidden border border-gray-100 dark:border-gray-800"
                 x-transition:enter="transition ease-out duration-300"
                 x-transition:enter-start="opacity-0 translate-y-4"
                 x-transition:enter-end="opacity-100 translate-y-0">
                
                <div class="p-6 border-b border-gray-100 dark:border-gray-800 flex justify-between items-center">
                    <h3 class="text-xl font-bold text-gray-900 dark:text-white">Pilih Genre</h3>
                    <button @click="filterOpen = false" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                        <span class="icon-[ri--close-line] w-6 h-6"></span>
                    </button>
                </div>
                
                <div class="p-2 max-h-[60vh] overflow-y-auto">
                    <button @click="genre = 'all'; filterOpen = false" 
                        class="w-full text-left px-4 py-3 rounded-xl hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors flex items-center justify-between group"
                        :class="genre === 'all' ? 'bg-indigo-50 dark:bg-indigo-900/20 text-indigo-600 dark:text-indigo-400' : 'text-gray-700 dark:text-gray-300'">
                        <span class="font-medium">Semua Genre</span>
                        <span x-show="genre === 'all'" class="icon-[ri--check-line] text-indigo-600 dark:text-indigo-400"></span>
                    </button>

                    {{ $genres := slice }}
                    {{ range .Pages }}
                        {{ if .Params.genre }}
                            {{ $genres = $genres | append .Params.genre }}
                        {{ end }}
                    {{ end }}
                    {{ range (uniq $genres | sort) }}
                    <button @click="genre = '{{ . }}'; filterOpen = false" 
                        class="w-full text-left px-4 py-3 rounded-xl hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors flex items-center justify-between group"
                        :class="genre === '{{ . }}' ? 'bg-indigo-50 dark:bg-indigo-900/20 text-indigo-600 dark:text-indigo-400' : 'text-gray-700 dark:text-gray-300'">
                        <span class="font-medium">{{ . }}</span>
                        <span x-show="genre === '{{ . }}'" class="icon-[ri--check-line] text-indigo-600 dark:text-indigo-400"></span>
                    </button>
                    {{ end }}
                </div>
            </div>
        </div>
    </main>
{{ end }}
