<section class="bg-white dark:bg-gray-800 rounded-2xl shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden"
    x-data="{
        search: '',
        filterChar: '',
        sortCol: '',
        sortAsc: true,
        items: {{ .Params.data | jsonify }},
        
        get filteredItems() {
            let result = this.items;
            
            // Filter by Search
            if (this.search) {
                const s = this.search.toLowerCase();
                result = result.filter(item => {
                    return Object.values(item).some(val => 
                        String(val).toLowerCase().includes(s)
                    );
                });
            }
            
            // Filter by Alphabet (assuming first column is the name/title)
            if (this.filterChar) {
                const keys = Object.keys(this.items[0] || {});
                if (keys.length > 0) {
                    const firstKey = keys[0];
                    result = result.filter(item => {
                        const val = String(item[firstKey]).trim();
                        return val.toUpperCase().startsWith(this.filterChar);
                    });
                }
            }
            
            // Sort
            if (this.sortCol) {
                result = result.sort((a, b) => {
                    let valA = String(a[this.sortCol] || '').toLowerCase();
                    let valB = String(b[this.sortCol] || '').toLowerCase();
                    
                    if (valA < valB) return this.sortAsc ? -1 : 1;
                    if (valA > valB) return this.sortAsc ? 1 : -1;
                    return 0;
                });
            }
            
            return result;
        },
        
        sortBy(col) {
            if (this.sortCol === col) {
                this.sortAsc = !this.sortAsc;
            } else {
                this.sortCol = col;
                this.sortAsc = true;
            }
        },
        
        clearFilters() {
            this.search = '';
            this.filterChar = '';
            this.sortCol = '';
            this.sortAsc = true;
        }
    }">
    
    {{ if .Params.data }}
    <!-- Controls -->
    <div class="p-6 bg-gray-50 dark:bg-gray-800/50 border-b border-gray-200 dark:border-gray-700 flex flex-col md:flex-row gap-4">
        <!-- Search -->
        <div class="relative flex-grow">
            <i class="icon-[ri--search-line] absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
            <input type="text" x-model="search" placeholder="Search data..." 
                class="w-full pl-10 pr-10 py-2 bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg text-gray-900 dark:text-white focus:ring-2 focus:ring-indigo-500 outline-none transition-colors">
            <button x-show="search" @click="search = ''" class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200">
                <i class="icon-[ri--close-line]"></i>
            </button>
        </div>

        <!-- Filter Alphabet -->
        <select x-model="filterChar" class="px-4 py-2 bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg text-gray-900 dark:text-white focus:ring-2 focus:ring-indigo-500 outline-none cursor-pointer">
            <option value="">All A-Z</option>
            {{ range $char := split "ABCDEFGHIJKLMNOPQRSTUVWXYZ" "" }}
            <option value="{{ $char }}">{{ $char }}</option>
            {{ end }}
        </select>
    </div>

    <!-- Info Bar -->
    <div class="px-6 py-2 bg-indigo-50 dark:bg-indigo-900/20 text-xs text-indigo-600 dark:text-indigo-400 font-medium border-b border-indigo-100 dark:border-indigo-900/30 flex justify-between items-center">
        <span x-text="`Showing ${filteredItems.length} of ${items.length} results`"></span>
        <button x-show="search || filterChar || sortCol" @click="clearFilters()" class="hover:underline">Clear Filters</button>
    </div>

    <!-- Table -->
    <div class="overflow-x-auto">
        <table class="w-full text-left border-collapse">
            {{ $firstItem := index .Params.data 0 }}
            {{ $columnOrder := slice }}
            {{ range $key, $value := $firstItem }}
                {{ $columnOrder = $columnOrder | append $key }}
            {{ end }}
            
            <thead>
                <tr class="bg-gray-50 dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700">
            {{ range $columnOrder }}
                    <th @click="sortBy('{{ . }}')" class="p-4 font-bold text-gray-900 dark:text-white cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors select-none whitespace-nowrap group">
                        <div class="flex items-center gap-2">
                            {{ . | title }}
                            <span class="text-gray-400 group-hover:text-gray-600 dark:group-hover:text-gray-300">
                                <i class="icon-[ri--arrow-up-s-fill]" :class="sortCol === '{{ . }}' && sortAsc ? 'text-indigo-600 dark:text-indigo-400' : 'opacity-30'"></i>
                                <i class="icon-[ri--arrow-down-s-fill] -ml-2" :class="sortCol === '{{ . }}' && !sortAsc ? 'text-indigo-600 dark:text-indigo-400' : 'opacity-30'"></i>
                            </span>
                        </div>
                    </th>
            {{ end }}
                </tr>
            </thead>
            <tbody class="divide-y divide-gray-100 dark:divide-gray-700">
                <template x-for="(item, index) in filteredItems" :key="index">
                    <tr class="hover:bg-gray-50 dark:hover:bg-gray-700/30 transition-colors">
                        {{ range $columnOrder }}
                            <td class="p-4 text-sm text-gray-600 dark:text-gray-300">
                                {{ if eq . "field" }}
                                    <span class="font-semibold text-gray-900 dark:text-white flex items-center gap-2">
                                        <i class="icon-[ri--information-line] text-indigo-500"></i>
                                        <span x-text="item.field || 'Field'"></span>
                                    </span>
                                {{ else if eq . "value" }}
                                    <div x-data>
                                        <a x-show="item.url" :href="item.url" target="_blank" rel="noopener" class="text-indigo-600 dark:text-indigo-400 hover:underline inline-flex items-center gap-1 font-medium">
                                            <span x-text="item.value"></span>
                                            <i class="icon-[ri--external-link-line]"></i>
                                        </a>
                                        <span x-show="!item.url" x-text="item.value"></span>
                                    </div>
                                {{ else if eq . "url" }}
                                     <a :href="item.url" target="_blank" class="text-indigo-600 hover:underline truncate block max-w-xs" x-text="item.url"></a>
                                {{ else }}
                                    <span x-text="item['{{ . }}'] || '-'"></span>
                                {{ end }}
                            </td>
                        {{ end }}
                    </tr>
                </template>
            </tbody>
        </table>
    </div>

    <!-- No Results -->
    <div x-show="filteredItems.length === 0" class="p-12 text-center" style="display: none;">
        <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-gray-100 dark:bg-gray-800 mb-4">
            <i class="icon-[ri--search-2-line] text-2xl text-gray-400"></i>
        </div>
        <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-1">No results found</h3>
        <p class="text-gray-500 dark:text-gray-400 mb-4">Try adjusting your search terms or filters.</p>
        <button @click="clearFilters()" class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors text-sm font-medium">
            Clear all filters
        </button>
    </div>
    {{ end }}
</section>