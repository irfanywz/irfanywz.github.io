{{ define "head" }}
{{ end }}

{{ define "main" }}
    <main class="flex-grow bg-white dark:bg-gray-900 transition-colors duration-300"
        x-data="{
            genre: 'all',
            filterOpen: false,
            items: [
                {{ range .Pages }}
                {
                    title: {{ .Title | jsonify }},
                    genres: {{ .Params.genres | default (slice) | jsonify }},
                    permalink: {{ .RelPermalink | jsonify }},
                    poster: {{ .Params.poster | jsonify }},
                    rating: {{ .Params.rating | jsonify }},
                    year: {{ .Params.year | jsonify }},
                    status: {{ .Params.status | lower | jsonify }}
                },
                {{ end }}
            ],
            get filteredItems() {
                if (this.genre === 'all') return this.items;
                return this.items.filter(i => i.genres && i.genres.includes(this.genre));
            }
        }">

        <div class="container max-w-6xl mx-auto px-4 py-12">
            <!-- Header 2 Kolom -->
            <div class="flex flex-col md:flex-row md:items-end justify-between gap-6 mb-12 border-b border-gray-100 dark:border-gray-800 pb-8">
                <div class="max-w-2xl">
                    <h1 class="text-4xl font-black text-gray-900 dark:text-white mb-2 tracking-tight flex items-center gap-3">
                        <span class="icon-[ri--movie-2-line] text-rose-500"></span>
                        {{ .Title }}
                    </h1>
                    <p class="text-lg text-gray-500 dark:text-gray-400">{{ .Description }}</p>
                </div>
                
                <button @click="filterOpen = true" class="flex items-center gap-2 px-5 py-2.5 bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-900 dark:text-white rounded-xl font-bold transition-all">
                    <span class="icon-[ri--filter-3-line]"></span>
                    <span x-text="genre === 'all' ? 'Semua Genre' : genre"></span>
                    <span class="icon-[ri--arrow-down-s-line] opacity-50"></span>
                </button>
            </div>

            <!-- Movie Grid -->
            <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-6">
                <template x-for="item in filteredItems" :key="item.permalink">
                    <a :href="item.permalink" class="group block bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden hover:shadow-lg hover:-translate-y-1 transition-all duration-300">
                        <div class="relative aspect-[2/3] overflow-hidden bg-gray-100 dark:bg-gray-700">
                            <img :src="item.poster" :alt="'Poster Film ' + item.title" class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110">
                            
                            <div class="absolute top-2 right-2">
                                <span class="px-2 py-1 bg-black/70 backdrop-blur-sm text-white text-xs font-bold rounded-md flex items-center gap-1">
                                    <i class="icon-[ri--star-fill] text-yellow-400"></i> <span x-text="item.rating"></span>
                                </span>
                            </div>

                            <template x-if="item.status === 'setengah menonton'">
                                <div class="absolute bottom-0 left-0 right-0 bg-indigo-600/90 text-white text-xs font-bold py-1 text-center backdrop-blur-sm">
                                    Setengah Menonton
                                </div>
                            </template>
                            <template x-if="item.status === 'belum ditonton'">
                                <div class="absolute bottom-0 left-0 right-0 bg-gray-800/90 text-white text-xs font-bold py-1 text-center backdrop-blur-sm">
                                    Belum Ditonton
                                </div>
                            </template>
                        </div>

                        <div class="p-4">
                            <h2 class="text-base font-bold text-gray-900 dark:text-white leading-tight mb-1 line-clamp-2 group-hover:text-indigo-600 dark:group-hover:text-indigo-400 transition-colors" x-text="item.title"></h2>
                            <div class="text-xs text-gray-500 dark:text-gray-400 flex flex-wrap gap-x-2 gap-y-1">
                                <span x-text="item.year"></span>
                                <span>â€¢</span>
                                <span class="truncate" x-text="item.genres[0]"></span>
                            </div>
                        </div>
                    </a>
                </template>
            </div>
            
            <div x-show="filteredItems.length === 0" class="text-center py-20" style="display: none;">
                <p class="text-gray-500">Tidak ada film dengan genre ini.</p>
            </div>
        </div>

        <!-- Filter Modal -->
        <div x-show="filterOpen" 
            style="display: none;"
            class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm"
            x-transition.opacity
            @click.self="filterOpen = false">
            
            <div class="bg-white dark:bg-gray-900 rounded-2xl shadow-2xl w-full max-w-md overflow-hidden border border-gray-100 dark:border-gray-800"
                 x-transition:enter="transition ease-out duration-300"
                 x-transition:enter-start="opacity-0 translate-y-4"
                 x-transition:enter-end="opacity-100 translate-y-0">
                
                <div class="p-6 border-b border-gray-100 dark:border-gray-800 flex justify-between items-center">
                    <h3 class="text-xl font-bold text-gray-900 dark:text-white">Pilih Genre</h3>
                    <button @click="filterOpen = false" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                        <span class="icon-[ri--close-line] w-6 h-6"></span>
                    </button>
                </div>
                
                <div class="p-2 max-h-[60vh] overflow-y-auto">
                    <button @click="genre = 'all'; filterOpen = false" 
                        class="w-full text-left px-4 py-3 rounded-xl hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors flex items-center justify-between group"
                        :class="genre === 'all' ? 'bg-indigo-50 dark:bg-indigo-900/20 text-indigo-600 dark:text-indigo-400' : 'text-gray-700 dark:text-gray-300'">
                        <span class="font-medium">Semua Genre</span>
                        <span x-show="genre === 'all'" class="icon-[ri--check-line] text-indigo-600 dark:text-indigo-400"></span>
                    </button>

                    {{ $allGenres := slice }}
                    {{ range .Pages }}
                        {{ range .Params.genres }}
                            {{ $allGenres = $allGenres | append . }}
                        {{ end }}
                    {{ end }}
                    {{ range (uniq $allGenres | sort) }}
                    <button @click="genre = '{{ . }}'; filterOpen = false" 
                        class="w-full text-left px-4 py-3 rounded-xl hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors flex items-center justify-between group"
                        :class="genre === '{{ . }}' ? 'bg-indigo-50 dark:bg-indigo-900/20 text-indigo-600 dark:text-indigo-400' : 'text-gray-700 dark:text-gray-300'">
                        <span class="font-medium">{{ . | humanize | title }}</span>
                        <span x-show="genre === '{{ . }}'" class="icon-[ri--check-line] text-indigo-600 dark:text-indigo-400"></span>
                    </button>
                    {{ end }}
                </div>
            </div>
        </div>
    </main>
{{ end }}

{{ define "footer" }}
{{ end }}